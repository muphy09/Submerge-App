# Auto-Update Setup Guide

## Overview

The PPAS Proposal Builder now includes automatic update functionality powered by `electron-updater`. This allows the app to:

- Automatically check for updates on startup
- Download updates in the background
- Notify users when updates are available
- Allow manual update checks via settings
- Apply updates on app restart

---

## Configuration

### 1. GitHub Repository Setup

The app is configured to check for updates from GitHub releases. You need to update the repository settings in `package.json`:

```json
"publish": [
  {
    "provider": "github",
    "owner": "YOUR_GITHUB_USERNAME",
    "repo": "PPAS"
  }
]
```

**Replace `YOUR_GITHUB_USERNAME` with your actual GitHub username.**

### 2. Publishing Releases

To publish an update that users can download:

1. **Build the application:**
   ```bash
   npm run build:exe
   ```

2. **Create a GitHub Release:**
   - Go to your repository on GitHub
   - Click "Releases" → "Create a new release"
   - Tag version: Use semantic versioning (e.g., `v1.0.1`, `v1.1.0`)
   - Upload the built installer from `portable builds/` folder
   - Upload the `latest.yml` file (generated by electron-builder)
   - Publish the release

3. **Version Numbering:**
   - Update the `version` field in `package.json` before building
   - The app compares versions to determine if an update is available
   - Use semantic versioning: MAJOR.MINOR.PATCH (e.g., 1.0.0 → 1.0.1)

---

## How It Works

### Automatic Update Flow

1. **On Startup** (3 seconds after app loads):
   - App checks GitHub for new releases
   - Compares current version with latest release version
   - If newer version exists, automatically downloads in background

2. **During Download:**
   - Small notification appears: "Update Downloading..."
   - Download happens silently without interrupting user

3. **When Ready:**
   - Notification changes to: "Update Completed, restart the App to apply"
   - User can click "Restart Now" or continue working
   - Update will be applied on next app restart

### Manual Update Check

Users can manually check for updates:

1. Click the **⚙️ Settings** button (top-right corner)
2. Click **"Check for Updates"** button
3. If no update available: Shows "Up to date!"
4. If update found: Download starts automatically

---

## Features

### Update Notifications

- **Downloading**: Shows spinner with "Update Downloading..." message
- **Ready**: Shows "Update Completed, restart the App to apply" with restart button
- **Error**: Shows error message if update fails
- **Up to Date**: Only shown when manually checking and no update available

### Settings Modal

- Access via gear icon (⚙️) in top-right corner
- "Check for Updates" button for manual checks
- Shows app version and about information
- Clean, modern UI with smooth animations

### Development Mode

- Updates are **disabled** in development mode
- No unnecessary update checks during development
- Manual checks show: "Updates disabled in development"

---

## Files Modified/Created

### Modified Files:
- `package.json` - Added electron-updater dependency and publish config
- `electron.ts` - Added auto-updater logic and event handlers
- `preload.ts` - Added IPC bridges for update functions
- `src/App.tsx` - Added settings button and update listeners
- `src/App.css` - Added settings button styles

### New Files:
- `src/components/UpdateNotification.tsx` - Update notification component
- `src/components/UpdateNotification.css` - Notification styles
- `src/components/SettingsModal.tsx` - Settings dialog component
- `src/components/SettingsModal.css` - Settings dialog styles
- `src/types/electron.d.ts` - TypeScript definitions for Electron API

---

## User Experience

### Automatic Updates (Background)
- **Silent**: No user interaction required
- **Non-intrusive**: Small notification in bottom-right corner
- **Flexible**: User can continue working during download
- **Optional**: User decides when to restart and apply update

### Manual Updates (Settings)
- **Accessible**: Settings gear icon always visible
- **Clear Feedback**: Shows checking status and results
- **Informative**: Displays current version and app info

---

## Technical Details

### Update Check Timing
- Automatic check: 3 seconds after app startup (production only)
- Manual check: On-demand via settings button
- Background check: Silent, doesn't interrupt user workflow

### Update Download
- Automatic: Downloads in background when update detected
- Progress: Monitored via IPC events
- Storage: Downloaded to system temp folder
- Verification: electron-updater verifies signatures

### Update Installation
- Auto-install on quit: Enabled by default
- Manual restart: User can trigger via "Restart Now" button
- Safe: Previous version available if update fails

### Security
- Code signature verification (when configured)
- HTTPS downloads from GitHub
- Checksums validated via latest.yml

---

## Troubleshooting

### Update Not Detected
1. Verify GitHub release is published (not draft)
2. Check version in `package.json` is higher than current
3. Ensure `latest.yml` is uploaded with release
4. Check repository name in publish config

### Update Download Fails
1. Check internet connection
2. Verify GitHub release assets are publicly accessible
3. Check console logs for error details
4. Ensure latest.yml has correct file URLs

### TypeScript Errors
1. Run `npx tsc` to check for type errors
2. Ensure `src/types/electron.d.ts` is included in tsconfig
3. Restart TypeScript server in IDE

---

## Production Checklist

Before releasing to production:

- [ ] Update version number in `package.json`
- [ ] Update `YOUR_GITHUB_USERNAME` in publish config
- [ ] Update `APP_VERSION` constant in `src/App.tsx`
- [ ] Build the app: `npm run build:exe`
- [ ] Create GitHub release with tag matching version
- [ ] Upload built executable to release
- [ ] Upload `latest.yml` to release
- [ ] Publish release (not draft)
- [ ] Test update on older version of app

---

## Future Enhancements

Potential improvements:
- Download progress percentage
- Release notes display
- Update channel selection (stable, beta)
- Automatic update scheduling
- Delta updates for smaller downloads
- Update download cancellation

---

## Resources

- [electron-updater Documentation](https://www.electron.build/auto-update)
- [GitHub Releases Guide](https://docs.github.com/en/repositories/releasing-projects-on-github)
- [Semantic Versioning](https://semver.org/)
